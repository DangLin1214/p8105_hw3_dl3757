---
title: "p8015_hw3_dl3757"
author: "Dang Lin dl3757"
date: "2024-10-16"
output: github_document
---

```{r message = FALSE}
# Import the libraries
library(tidyverse)
library(knitr)
library(patchwork)
library(p8105.datasets)
```

# Problem 1
## (a)
```{r message = FALSE}
# Load the data and convert data to the data frame
data("ny_noaa")
ny_noaa <- as.data.frame(ny_noaa)

# Clean the dataset 
ny_noaa_tidy <- ny_noaa %>%
  mutate(
    date = as.Date(date, format = "%Y-%m-%d"),
    year = year(date),
    month = month(date),
    day = day(date), 
    prcp = as.numeric(prcp) / 10, 
    tmax = as.numeric(tmax) / 10, 
    tmin = as.numeric(tmin) / 10)

# Find the most commonly snowfall values
most_commonly_snowfall_values <- ny_noaa_tidy %>% 
  filter(!is.na(snow)) %>% 
  group_by(snow) %>% 
  summarise(count = n()) %>% 
  arrange(desc(count)) %>% 
  head(n = 5) %>% 
  rename("Snowfall Values" = snow, 
         "Count" = count)

knitr::kable(most_commonly_snowfall_values, 
             caption = "The Most Commonly Snowfall Values (mm)")
```

The most common snowfall values are 0mm, 25mm, 13mm, 51mm, and 76mm. This is likely because the dataset only includes snowfall measurements from New York State, rather than from the entire nation.

## (b)
```{r message = FALSE, warning = FALSE}
# Create the average max temperature data frame 
average_tmax_df <- ny_noaa_tidy %>% 
  filter(month == 1 | month == 7) %>% 
  group_by(id, year, month) %>% 
  summarise(average_tmax = mean(tmax, na.rm = TRUE)) %>% 
  arrange(id, year, month)

# Make a two-panel plot showing the average max temperature in January and in July 
# in each station across years
average_tmax_df %>%
  ggplot(aes(x = year, y = average_tmax)) +
  geom_line(aes(color = id)) +
  facet_wrap(~ month, scales = "free_y", 
             labeller = labeller(month = c('1' = "January", '7' = "July")), 
             ncol = 1) + 
  labs(title = "Average Max Temperature in January and July", 
       x = "Year", 
       y = "Average Max Temperature (degree Celsius)") +
  theme_minimal() + 
  theme(legend.position = "none")
```

From the plot, we can observe that the average maximum temperatures in both January and July fluctuate over the years, but there is no clear pattern. Additionally, it is worth mentioning an outlier in July 1988, which might have been caused by extreme weather conditions in that month or errors in the data collection process. 

## (c)
```{r message = FALSE}
# Plot the density plot of maximum and minimum temperatures
plot_1 <- ny_noaa_tidy %>% 
  filter(!is.na(tmax) & !is.na(tmin)) %>% 
  select(id, tmax, tmin) %>% 
  pivot_longer( 
    tmax:tmin, 
    names_to = "observation", 
    values_to = "temp") %>% 
  ggplot(aes(x = temp, fill = observation)) + 
  geom_density(alpha = 0.5) + 
  viridis::scale_fill_viridis(discrete = TRUE) +  
  theme_minimal() + 
  labs(title = "Density Plot of Maximum and Minimum Temperatures", 
       x = "Temperature (degree Celsius)", 
       y = "Density")

# Plot the boxplot of distribution of snowfall values by year
plot_2 <- ny_noaa_tidy %>% 
  filter(snow > 0 & snow < 100) %>% 
  ggplot(aes(x = as.factor(year), y = snow, fill = as.factor(year))) + 
  geom_boxplot() + 
  labs(title = "Distribution of Snowfall Values by Year", 
       x = "Year", 
       y = "Snowfall Value", 
       fill = "Year") + 
  theme_minimal() + 
  theme(axis.text.x = element_text(angle = 90, hjust = 0.8), 
        legend.text = element_text(size = 6), 
        legend.key.size = unit(0.4, "cm"), 
        legend.title = element_text(size = 8))

# Combine two plots into one two-panel plot
plot_1 / plot_2
```